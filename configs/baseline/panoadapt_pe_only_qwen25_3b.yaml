# Ablation: PanoAdapt PE Only (no overlap loss) — Qwen2.5-VL-3B
#
# Identical to B1-fix config EXCEPT overlap_loss disabled.
# Purpose: Isolate the effect of DenseCL overlap loss with vision LoRA fix.
# Compare CIDEr against:
#   - B1-fix (this config + overlap_loss: true + vision LoRA) → gradient flow effect
#   - B1 original (overlap_loss: true, NO vision LoRA) → vision LoRA necessity

experiment_name: "panoadapt_pe_only_qwen25-vl-3b"
output_dir: "runs/baseline"
max_new_tokens: 128

model:
  name: "panoadapt_qwen25-vl-3b"
  hf_model_id: "Qwen/Qwen2.5-VL-3B-Instruct"
  model_type: "qwen_vl"
  dtype: "float16"
  image_size: 224

lora:
  r: 32
  alpha: 64
  dropout: 0.1
  # Same as B1-fix: includes vision encoder targets for fair comparison
  # Even though overlap_loss is off, vision LoRA may still help LM loss backprop
  target_modules:
    - "q_proj"
    - "k_proj"
    - "v_proj"
    - "o_proj"
    - "attn.qkv"
    - "attn.proj"

training:
  num_epochs: 1
  batch_size: 1
  gradient_accumulation_steps: 4
  learning_rate: 5e-5
  warmup_ratio: 0.03
  weight_decay: 0.01
  max_grad_norm: 1.0
  max_length: 3072
  seed: 42
  gradient_checkpointing: true
  mixed_precision: "fp16"
  logging_steps: 10
  save_strategy: "epoch"
  save_total_limit: 2
  dataloader_num_workers: 4

data:
  image_column: "url"
  instruction_column: "instruction"
  response_column: "response"

anyres_e2p:
  hfov_deg: 45.0
  overlap: 0.0
  closed_loop_yaw: true
  pitch_min: 0.0
  pitch_max: 0.0
  base_size: 336
  tile_render_size: 672

panoadapt:
  model_type: "qwen_vl"
  rope_type: "3d"
  spatial_pe: true
  overlap_loss: false
  overlap_loss_weight: 0.0
  overlap_loss_temperature: 0.07
  overlap_ratio: 0.5

data_train_csv: "/data/1_personal/4_SWWOO/panollava/runs/baseline/_shared_data/train.csv"
data_test_csv: "/data/1_personal/4_SWWOO/panollava/runs/baseline/_shared_data/test.csv"

wandb_enabled: false
